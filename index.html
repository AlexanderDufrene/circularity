<!doctype html>

<html>
	<head>
		<meta charset="utf-8">

		<title>Operation Spark || Motion Poem</title>
		<meta name="description" content="Operation Spark Motion Poem">
		<meta name="author" content="operationspark.org">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	    
	    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
	    <link href="css/style.css" rel="stylesheet">

		<!-- all core CreateJS and 3rd party libraries are listed here: -->
		<script src="bower_components/lodash/dist/lodash.min.js"></script>
		<script src="bower_components/easeljs/lib/easeljs-0.8.0.min.js"></script>
		<script src="bower_components/preloadjs/lib/preloadjs-0.6.0.min.js"></script>
		<script src="bower_components/soundjs/lib/soundjs-0.6.0.min.js"></script>
		<script src="bower_components/opspark-draw/draw.js"></script>

	    <!-- our app javascript code -->
	    <script src="js/opspark.js"></script>
	</head>
	<body>
		<div>
			<!-- canvas element that serves as the stage for our app or game -->
			<canvas id="canvas" width="500" height="500"></canvas>
		</div>
		<script id="motion-poem">
			(function(){
				'use strict';

				window.opspark = window.opspark || {};
				
				var 
					draw = window.opspark.draw,
					app = opspark.makeApp(update),
					canvas = app.canvas, 
					view = app.view;

				var i, circle;

				i = 0;

				while (i < 100) {
					var radius = randomIntBetween(5, 20);
					
					// generate a random color but randomize the palette limiter //
					var randomColor = draw.randomColor(
						randomIntBetween(0, 255), 
						randomIntBetween(0, 255), 
						randomIntBetween(0, 255));

					var line = draw.line(radius, 0, radius, 0, '#FFF', 2);
					var circle = draw.circle(radius, randomColor, line);
					circle.alpha = Math.random();

					if (circle.alpha < .2) {
						var blurFilter = new createjs.BlurFilter(5, 5, 1);
						circle.filters = [blurFilter];
						circle.cache(-circle.radius, -circle.radius, circle.width, circle.height);
					}

					circle.x = randomIntBetween(0, canvas.width);
					circle.y = randomIntBetween(0, canvas.height);
					view.addChild(circle);

					addRandomDirectionalVelocity(circle, canvas);

					i++;
				}

                function update() {						
					var circles = view.children;
					var circle;
					for (var i = 0; i < circles.length; i++) {
						circle = circles[i];
						
						updateDirectionalVelocity(circle);

						if (circle.x - circle.radius > canvas.width) {
	                        circle.x = -circle.radius;
	                    }
	                    else if (circle.x + circle.radius < 0)
	                    {
	                        circle.x = canvas.width + circle.radius;
	                    }

	                    if (circle.y - circle.radius > canvas.height)
	                    {
	                        circle.y = -circle.radius;
	                    }
	                    else if (circle.y < -circle.radius)
	                    {
	                        circle.y = canvas.height + circle.radius;
	                    }
					}
                }

                function addRandomDirectionalVelocity(body, space) {
					var tx = randomIntBetween(0, space.width);
            		var ty = randomIntBetween(0, space.height);
					var dx = Math.abs(tx - body.x);
		            var dy = Math.abs(ty - body.y);
		            var angle = Math.atan2(dy, dx);
		            body.rotation = angle;

		            var r = (Math.round(Math.random()) === 1) ? 1 : -1;
		            body.rotationalForce = randomIntBetween(1, 3) * r;
		            var forceX = Math.cos(angle) * (Math.random() * .6);
		            var forceY = Math.sin(angle) * (Math.random() * .5);

		            body.velocityX = (tx > body.x) ? forceX : -forceX;
		            body.velocityY = (ty > body.y) ? forceY : -forceY;
				}

				function updateDirectionalVelocity(body) {
					body.x += body.velocityX;
					body.y += body.velocityY;
					body.rotation += body.rotationalForce;
				}

                function randomIntBetween(min, max)
				{
				    return Math.floor(Math.random() * (max - min + 1) + min);
				}
			})();
		</script>
	</body>

</html>